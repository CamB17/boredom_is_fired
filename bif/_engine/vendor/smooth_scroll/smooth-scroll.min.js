jQuery(document).ready(function ($) {
    $(window).on("load resize", function () {
        $('a[href*="#"]').not('.shiftnav a[href*="#"]').not('.open-popup-link').not('#skip_to_content').not('.tab_title').not('[href="#"]').not('[role="tab"]').not('[href="#0"]').not(".social-link").click(function (t) {
            let current_url = window.location.hostname + window.location.pathname;
            let clicked_url = $(this)[0].hostname + $(this)[0].pathname;
            if (current_url == clicked_url) {
                //is on page anchor link
                inPageNavHeight = $('.pb-in-page_navigation').outerHeight();

                headerHeight = $('header.cloned').outerHeight() - 20;
                
                adminBarHeight = $('#wpadminbar').outerHeight();
                t.preventDefault();
                totalHeight = inPageNavHeight + headerHeight + adminBarHeight + 20;
                if (location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") && location.hostname == this.hostname) {
                    var e = $(this.hash);
                    e = e.length ? e : $("[name=" + this.hash.slice(1) + "]");
                    if (e.length) {
                        
                        let scrollTo = e.offset().top - totalHeight;
                        
                        // isAnimating = true;
                        // console.log("isAnimating true");
                        // $("html, body").animate({ scrollTop: e.offset().top - totalHeight }, 1e3, function () {
                        //     isAnimating = false;
                        //     console.log("isAnimating false1");
                        // });
                        // var page = $("html, body");

                        // page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function() {
                        //     page.stop();
                        // });

                        // page.animate({ scrollTop: e.offset().top - totalHeight }, 800, function() {
                        //     page.stop();
                        //     page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove");
                        // });
                        
                        window.scrollTo({top: scrollTo, behavior: 'smooth'});
                    }
                }
            }
        });
    });
    // if theres a hashtag in the URL, smooth scroll to it
    if (window.location.hash) {
        window.scrollTo(0, 0);
        var hash = window.location.hash;
        var element_to_scroll = jQuery(hash);
        if (element_to_scroll.length) {
            if (jQuery(window).width() < 1025) {
                extra_device_scroll = -45;
            }
            else {
                extra_device_scroll = -125;
            }
            admin_bar_height = jQuery('#wpadminbar').outerHeight();
            total_scroll_amount = element_to_scroll.offset().top + extra_device_scroll - admin_bar_height;
            jQuery("html, body").animate({ scrollTop: total_scroll_amount }, 1000);
        }
    }
});
